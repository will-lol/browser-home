import{jsx as t}from"react/jsx-runtime";import{serve as r}from"https://deno.land/std@0.164.0/http/server.ts";import{createServer as e}from"ultra/server.ts";import{App as a}from"./src/app.tsx";import{createHeadInsertionTransformStream as s}from"ultra/stream.ts";import{stringify as o,tw as n}from"./src/twind/twind.ts";let i=await e({importMapPath:import.meta.resolve("./importMap.json"),browserEntrypoint:import.meta.resolve("./client.tsx")});function m({context:r}){let e=new URL(r.req.url),s=e.searchParams.get("start"),o=e.searchParams.get("end");return s&&o?(s=parseInt(s),o=parseInt(o)):(s=null,o=null),t(a,{startDate:s,endDate:o})}i.use("*",async(t,r)=>{t.res.headers.set("Access-Control-Allow-Origin","*"),t.res.headers.set("Content-Security-Policy","frame-ancestors *"),await r()}),i.get("*",async r=>{let e=await i.render(t(m,{context:r}),{}),a=s(()=>{if(Array.isArray(n.target))return Promise.resolve(o(n.target));throw Error("Expected tw.target to be an instance of an Array")});return e=e.pipeThrough(a),r.body(e,200,{"content-type":"text/html; charset=utf-8"})}),import.meta.main&&r(i.fetch);export default i;